{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doctor Profile</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

<style>
  body {
    background: linear-gradient(135deg, #ffe4ec 0%, #f8e8ff 50%, #fde4f0 100%);
    min-height: 100vh;
    font-family: 'Poppins', sans-serif;
  }
  .card {
    backdrop-filter: blur(12px);
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 24px rgba(0,0,0,0.05);
  }
  .btn-love {
    background: linear-gradient(90deg, #ff9acb, #d8a7ff);
    color: white;
  }
  .btn-love:hover {
    background: linear-gradient(90deg, #ffb3d9, #e5bfff);
    transform: scale(1.05);
  }
</style>
</head>
<body>

{% include "doctor_sidebar.html" %}

<div class="max-w-4xl mx-auto mt-10 space-y-6 px-4">

  <!-- Top Card -->
  <div class="card rounded-2xl p-6 flex flex-col sm:flex-row items-center sm:space-x-6 space-y-4 sm:space-y-0 transition transform hover:scale-105 relative">
    <div class="relative">
      <div id="avatarDiv" class="w-28 h-28 rounded-full bg-pink-300 flex items-center justify-center text-white text-6xl shadow-lg overflow-hidden">
        {% if profile.profile_pic %}
          <img src="{{ profile.profile_pic.url }}" alt="Profile" class="w-full h-full object-cover rounded-full">
        {% else %}
          {% if doctor.gender == "Male" %}
            <img src="https://cdn-icons-png.flaticon.com/512/8815/8815112.png" alt="Male Doctor" class="w-full h-full object-cover rounded-full">
          {% elif doctor.gender == "Female" %}
            <img src="https://cdn-icons-png.flaticon.com/512/9439/9439276.png" alt="Female Doctor" class="w-full h-full object-cover rounded-full">
          {% else %}
            <img src="https://cdn-icons-png.flaticon.com/512/17773/17773479.png" alt="Doctor Icon" class="w-full h-full object-cover rounded-full">
          {% endif %}
        {% endif %}
      </div>

      <!-- Upload -->
      <form id="avatarForm" method="POST" enctype="multipart/form-data" class="absolute bottom-0 right-0 hidden">
        {% csrf_token %}
        <input type="file" id="avatarInput" name="profile_pic" accept="image/*" class="hidden">
      </form>

      <button type="button" id="changeAvatarBtn" class="absolute bottom-0 right-0 bg-white rounded-full p-2 shadow-md hover:bg-pink-100 transition">
        <i class="fas fa-camera text-pink-400"></i>
      </button>

      {% if profile.profile_pic %}
      <form method="POST" action="{% url 'delete_doctor_pic' %}" class="absolute top-0 right-0">
        {% csrf_token %}
        <button type="submit" class="bg-white rounded-full p-2 shadow-md hover:bg-rose-100 transition" onclick="return confirm('Delete profile picture?')">
          <i class="fa-solid fa-trash text-rose-500"></i>
        </button>
      </form>
      {% endif %}
    </div>

    <div class="text-center sm:text-left">
      <h2 class="text-2xl font-bold text-pink-600">Dr. {{ doctor.name }}</h2>
      <p class="text-gray-700 capitalize">{{ doctor.user_type }}</p>
      <p class="text-pink-500 font-semibold">{{ profile.specialization }}</p>
      <p class="text-gray-600">{{ profile.highest_qualification }}</p>
    </div>
  </div>

  <!-- Info Card -->
  <div id="infoCard" class="card rounded-2xl p-6 space-y-4 transition transform hover:scale-105">
    {% if messages %}
      <div class="mb-4 space-y-1">
        {% for message in messages %}
          <div class="text-green-600 font-semibold bg-green-100 px-4 py-2 rounded-lg">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form id="profileForm" method="POST" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}

      <!-- Edit View -->
      <div id="editView" class="space-y-4 hidden">
        {% comment %} Each input with label + placeholder {% endcomment %}
        <label class="block text-sm font-semibold text-pink-600">Full Name</label>
        <input type="text" name="name" value="{{ doctor.name }}" placeholder="Enter full name" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Email</label>
        <input type="email" name="email" value="{{ doctor.email }}" placeholder="Enter email" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Phone</label>
        <input type="text" name="phone" value="{{ doctor.phone }}" placeholder="Enter phone number" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Gender</label>
        <select name="gender" id="genderSelect" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">
          {% for g in genders %}
            <option value="{{ g }}" {% if g == doctor.gender %}selected{% endif %}>{{ g }}</option>
          {% endfor %}
        </select>

        <label class="block text-sm font-semibold text-pink-600">Specialization</label>
        <input type="text" name="specialization" value="{{ profile.specialization }}" placeholder="Enter specialization" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Highest Qualification</label>
        <input type="text" name="highest_qualification" value="{{ profile.highest_qualification }}" placeholder="Enter highest qualification" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">License Number</label>
        <input type="text" name="license" value="{{ profile.license }}" placeholder="Enter license number" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Experience (Years)</label>
        <input type="number" name="experience_years" value="{{ profile.experience_years }}" placeholder="Enter years of experience" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Areas of Expertise</label>
        <input type="text" name="expertise_areas" value="{{ profile.expertise_areas }}" placeholder="Enter expertise areas" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Specialized Treatments</label>
        <input type="text" name="specialized_treatments" value="{{ profile.specialized_treatments }}" placeholder="Enter specialized treatments" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Consultation Fee:</label>
        <input type="text" name="visit_fee" value="{{ doctor.visit_fee }}" placeholder="Enter your consultation fee" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">

        <label class="block text-sm font-semibold text-pink-600">Biography</label>
        <textarea name="biography" rows="4" placeholder="Write short biography..." class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">{{ profile.biography }}</textarea>
      
        <label class="block text-sm font-semibold text-pink-600">Address</label>
        <textarea name="address" rows="3" placeholder="Enter address" class="w-full border border-pink-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-300">{{ doctor.address }}</textarea>
      </div>

      <!-- Read View with Labels -->
      <div id="readView" class="space-y-3 text-gray-700">
        <p><span class="font-semibold text-pink-600">Email:</span> {{ doctor.email }}</p>
        <p><span class="font-semibold text-pink-600">Phone:</span> {{ doctor.phone }}</p>
        <p><span class="font-semibold text-pink-600">Gender:</span> {{ doctor.gender }}</p>
        <p><span class="font-semibold text-pink-600">Specialization:</span> {{ profile.specialization }}</p>
        <p><span class="font-semibold text-pink-600">Qualification:</span> {{ profile.highest_qualification }}</p>
        <p><span class="font-semibold text-pink-600">License:</span> {{ profile.license }}</p>
        <p><span class="font-semibold text-pink-600">Experience:</span> {{ profile.experience_years }} years</p>
        <p><span class="font-semibold text-pink-600">Expertise:</span> {{ profile.expertise_areas }}</p>
        <p><span class="font-semibold text-pink-600">Treatments:</span> {{ profile.specialized_treatments }}</p>
        <p><span class="font-semibold text-pink-600">Consultation Fee:</span> {{ doctor.visit_fee }} TK</p>
        <p><span class="font-semibold text-pink-600">Biography:</span> {{ profile.biography }}</p>
        <p><span class="font-semibold text-pink-600">Address:</span> {{ doctor.address }}</p>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end space-x-2 mt-4">
        <button type="button" id="toggleBtn" class="btn-love px-4 py-2 rounded-xl transition">Edit</button>
        <button type="submit" id="saveBtn" class="bg-gradient-to-r from-pink-400 to-purple-400 text-white px-4 py-2 rounded-xl hover:from-pink-500 hover:to-purple-500 transition hidden">Save</button>
      </div>
    </form>
  </div>
</div>

<script>
const changeAvatarBtn = document.getElementById('changeAvatarBtn');
const avatarInput = document.getElementById('avatarInput');
const avatarForm = document.getElementById('avatarForm');
changeAvatarBtn.addEventListener('click', () => avatarInput.click());
avatarInput.addEventListener('change', () => avatarForm.submit());

// Toggle Edit / Read
const toggleBtn = document.getElementById('toggleBtn');
const saveBtn = document.getElementById('saveBtn');
const readView = document.getElementById('readView');
const editView = document.getElementById('editView');
toggleBtn.addEventListener('click', () => {
  const editing = !editView.classList.contains('hidden');
  editView.classList.toggle('hidden', editing);
  readView.classList.toggle('hidden', !editing);
  saveBtn.classList.toggle('hidden', editing);
  toggleBtn.textContent = editing ? 'Edit' : 'Cancel';
});

// Live Avatar Preview + Gender Avatar Auto Change
const avatarDiv = document.getElementById("avatarDiv");
const genderSelect = document.getElementById("genderSelect");
const profilePicInput = document.getElementById("avatarInput");

profilePicInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = ev => avatarDiv.innerHTML = `<img src="${ev.target.result}" class="w-full h-full rounded-full object-cover">`;
    reader.readAsDataURL(file);
  }
});

// Change avatar preview when gender changes
genderSelect.addEventListener("change", (e) => {
  const gender = e.target.value;
  let imgUrl;
  if(gender === "Male"){
    imgUrl = "https://cdn-icons-png.flaticon.com/512/8815/8815112.png";
  } else if(gender === "Female"){
    imgUrl = "https://cdn-icons-png.flaticon.com/512/9439/9439276.png";
  } else {
    imgUrl = "https://cdn-icons-png.flaticon.com/512/17773/17773479.png";
  }
  avatarDiv.innerHTML = `<img src="${imgUrl}" class="w-full h-full object-cover rounded-full">`;
});
</script>

</body>
</html>
